@page "/test"
@rendermode InteractiveServer

<PageTitle>Test Page</PageTitle>

<FluentLabel Typo="Typography.H3">Test Page</FluentLabel>

<FluentCard Style="margin: 16px 0;">
    <FluentStack Orientation="Orientation.Vertical">
        <FluentLabel>Counter: @counter</FluentLabel>
        <FluentLabel>Has rendered: @hasRendered</FluentLabel>
        <FluentLabel>Data loaded: @dataLoaded</FluentLabel>
        <FluentLabel>Time: @currentTime</FluentLabel>
    </FluentStack>
</FluentCard>

@if (isLoading)
{
    <FluentProgressRing />
    <FluentLabel>Loading...</FluentLabel>
}
else
{
    <FluentMessageBar Intent="MessageIntent.Success">Loading complete!</FluentMessageBar>
    
    @if (testData != null)
    {
        <FluentCard Style="margin: 16px 0;">
            @foreach (var item in testData)
            {
                <FluentLabel>• @item</FluentLabel>
            }
        </FluentCard>
    }
}

<FluentStack Orientation="Orientation.Horizontal">
    <FluentButton Appearance="Appearance.Accent" OnClick="IncrementCounter">
        Increment Counter
    </FluentButton>
    <FluentButton Appearance="Appearance.Neutral" OnClick="LoadTestData">
        Load Test Data
    </FluentButton>
</FluentStack>

@code {
    private int counter = 0;
    private bool hasRendered = false;
    private bool dataLoaded = false;
    private bool isLoading = false;
    private string currentTime = DateTime.Now.ToString("HH:mm:ss");
    private List<string>? testData;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            hasRendered = true;
            currentTime = DateTime.Now.ToString("HH:mm:ss");
            await InvokeAsync(StateHasChanged);
            
            // Auto-load data after first render
            await LoadTestData();
        }
    }

    private void IncrementCounter()
    {
        counter++;
        currentTime = DateTime.Now.ToString("HH:mm:ss");
    }

    private async Task LoadTestData()
    {
        isLoading = true;
        await InvokeAsync(StateHasChanged);
        
        // Simulate API call
        await Task.Delay(1000);
        
        testData = new List<string>
        {
            "Item 1",
            "Item 2",
            "Item 3",
            "Item 4",
            "Item 5"
        };
        
        dataLoaded = true;
        isLoading = false;
        currentTime = DateTime.Now.ToString("HH:mm:ss");
        await InvokeAsync(StateHasChanged);
    }
}
